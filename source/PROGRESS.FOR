C     SUBROUTINE UPDATE_PROGRESS
C
C     THIS SUBROUTINE DISPLAYS A MODERN PROGRESS BAR ON A SINGLE LINE
C     FOR THE OPENSES SIMULATION
C
      SUBROUTINE UPDATE_PROGRESS(CURTIME, PERCENT_VAL)
C
C     INCLUDE                                  ( DATE: 13 FEBRUARY 2026 )
C
      INCLUDE  'DSHARE'
C
      REAL CURTIME
      INTEGER PERCENT_VAL
      INTEGER I
      CHARACTER*80 PROGBUF
C
C     BUILD PROGRESS BAR STRING
      WRITE(PROGBUF, 100) CURTIME, PERCENT_VAL
C
C     ADD PROGRESS BAR CHARACTERS (20 positions)
      DO I = 1, 20
        IF (I .LE. (PERCENT_VAL/5)) THEN
          PROGBUF(25+I:25+I) = '#'
        ELSE
          PROGBUF(25+I:25+I) = '.'
        END IF
      END DO
C
C     ADD CLOSING BRACKET TO PROGRESS BAR
      PROGBUF(46:46) = ']'
      
C     WRITE THE PROGRESS BAR WITH CARRIAGE RETURN TO OVERWRITE SAME LINE
      IF (PERCENT_VAL .LT. 100) THEN
        WRITE(SCREEN, 200) CHAR(13), PROGBUF  ! CHAR(13) is carriage return
      ELSE
        WRITE(SCREEN, 201) CHAR(13), PROGBUF, ' COMPLETE!'
      END IF
C
  100 FORMAT('Time: ', F10.2, 's [', I3, '%] [')
  200 FORMAT(A1, A46, ']')
  201 FORMAT(A1, A46, ']', A)
C
      RETURN
      END